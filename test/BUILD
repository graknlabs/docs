######################################################
# generating and running the java snippet test class #
######################################################

java_test(
    name = "java-snippet-test",
    test_class = "generated.JavaSnippetTest",
    srcs = [":java-snippet-test-generator"],
    deps = [
        "@graknlabs_grakn//client-java:client-java",
        "@graknlabs_grakn//server:server",
        "@graknlabs_grakn//test-integration/rule:grakn-test-server"
    ],
    classpath_resources = [
        "@graknlabs_grakn//test-integration/resources:logback-test",
    ],
    data = [
        "//files:social-network-kg", # filegroup defined in files/BUILD
        "cassandra-embedded.yaml",
        "grakn.properties"
    ]
)

genrule(
    name = "java-snippet-test-generator",
    srcs = [
        "generate_java_snippet_tests.py",
        "//:content" # filegroup defined in root/BUILD
    ],
    cmd = "python $(location generate_java_snippet_tests.py) $@ $(locations //:content)",
    outs = ["generated/JavaSnippetTest.java"]
)


#######################################################
# generating and running the graql snippet test class #
#######################################################

java_test(
    name = "graql-snippet-test",
    test_class = "generated.GraqlSnippetTest",
    srcs = [":graql-snippet-test-generator"],
    deps = [
        "@graknlabs_grakn//client-java:client-java",
        "@graknlabs_grakn//server:server",
        "@graknlabs_grakn//test-integration/rule:grakn-test-server"
    ],
    classpath_resources = [
        "@graknlabs_grakn//test-integration/resources:logback-test",
    ],
    data = [
        "//files:social-network-kg", # filegroup defined in files/BUILD
        "cassandra-embedded.yaml",
        "grakn.properties"
    ]
)

genrule(
    name = "graql-snippet-test-generator",
    srcs = [
        "generate_graql_snippet_tests.py",
        "//:content" # filegroup defined in root/BUILD
    ],
    cmd = "python $(location generate_graql_snippet_tests.py) $@ $(locations //:content)",
    outs = ["generated/GraqlSnippetTest.java"]
)